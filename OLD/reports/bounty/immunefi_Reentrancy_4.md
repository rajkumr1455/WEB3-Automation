# Immunefi Bug Report

**Program**: VulnerableBank
**Network**: eth
**Severity Assessment**: High

---

# High Severity: Reentrancy

## Summary

**Vulnerability Type**: Reentrancy  
**Severity**: High  
**CVSS Score**: N/A  
**Confidence**: 100.0% (ML-verified)  
**Contract**: VulnerableBank  
**Chain**: ETH  

The withdraw function is vulnerable to reentrancy because the external call (to msg.sender) is made before updating the state of the contract. If the recipient calls this contract again during the execution of the external call, it can manipulate the state and potentially steal funds.

---

## Impact Analysis


---

## Proof of Concept

### Verification Status

---

## Vulnerable Code

**Location**: Line 18

```solidity

pragma solidity ^0.8.0;

/**
 * @title VulnerableBank
 * @dev Intentionally vulnerable contract for testing
 * VULNERABILITY: Reentrancy in withdraw()
 */
contract VulnerableBank {
    mapping(address => uint256) public balances;
    
    event Deposit(address indexed user, uint256 amount);
    event Withdrawal(address indexed user, uint256 amount);
    
    function deposit() public payable {
        require(msg.value > 0, "Must deposit something");
        balances[msg.sender] += msg.value;
        emit Deposit(msg.sender, msg.value);
    }
    
    // VULNERABLE: State updated after external call!
    function withdraw() public {
        uint256 amount = balances[msg.sender];
        require(amount > 0, "No balance");
        
        // External call BEFORE state update - reentrancy risk!
        (bool success, ) = msg.sender.call{value: amount}("");
        require(success, "Transfer failed");
        
        balances[msg.sender] = 0;  // Too late!
    }
    
    function getBal
...
```


---

## Recommended Fix


**Reentrancy Fix:**

1. **Use Checks-Effects-Interactions Pattern:**
   ```solidity
   function withdraw() public {
       uint amt = balances[msg.sender];
       balances[msg.sender] = 0;  // Update state BEFORE external call
       (bool s,) = msg.sender.call{value: amt}("");
       require(s, "Transfer failed");
   }
   ```

2. **Add ReentrancyGuard:**
   ```solidity
   import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
   
   contract Vault is ReentrancyGuard {
       function withdraw() public nonReentrant {
           // Safe from reentrancy
       }
   }
   ```

3. **Use pull payment pattern** instead of push



---

## Disclosure Timeline

- **Discovered**: 2025-11-24 12:10 UTC
- **Verified**: N/A
- **Reported**: 2025-11-24 12:10 UTC

---

*Report generated by Web3 Hunter ML-Enhanced Scanner*  
*Vulnerability ID: 4 | Scan ID: 4*
